<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadrature Integration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: #f3f4f6;
      color: #1f2937;
      }
    </style>
  </head>
  <body class="p-6 md:p-10">
    
    <!-- Main Container -->
    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-2xl p-6 md:p-8 space-y-8">
      
      <h1 class="text-3xl md:text-4xl font-extrabold text-center text-gray-900 mb-6">Quadrature Integration</h1>
      
      <div class="flex flex-col md:flex-row gap-6">
        <!-- Canvas and Details -->
        <div class="w-full md:w-3/4 bg-gray-50 rounded-lg p-2 border border-gray-200 shadow-inner relative">
          <canvas id="quadCanvas" class="w-full h-96 bg-white rounded-lg"></canvas>
          <div class="absolute top-4 right-4 p-3 bg-white bg-opacity-80 rounded-lg shadow-md text-sm">
            <div class="flex items-center space-x-2">
              <div class="w-4 h-1.5 rounded-full bg-green-500"></div>
              <span>Function $f(x)$</span>
            </div>
            <div class="flex items-center space-x-2 mt-1">
              <div class="w-4 h-1.5 rounded-full bg-blue-500"></div>
              <span>Area Approximation</span>
            </div>
          </div>
          <div id="quad-results" class="mt-4 p-4 bg-white rounded-lg shadow-md border border-gray-100 space-y-2">
            <p class="text-gray-800 font-medium">True Integral Value: <span id="true-integral" class="font-mono text-green-600"></span></p>
            <p class="text-gray-800 font-medium">Approximation Value: <span id="approx-value" class="font-mono text-blue-600"></span></p>
            <p class="text-gray-800 font-medium">Error: <span id="quad-error-value" class="font-mono text-red-600"></span></p>
          </div>
        </div>
        
        <!-- Controls -->
        <div class="w-full md:w-1/4 bg-gray-50 rounded-lg p-6 space-y-6 shadow-md border border-gray-200">
          <div>
            <label for="a-slider" class="block text-lg font-bold mb-2">Lower Bound $a$</label>
            <input type="range" id="a-slider" min="-3" max="3" value="-3" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
            <span id="a-label" class="text-sm text-gray-600 mt-1 block text-center font-mono"></span>
          </div>
          <div>
            <label for="b-slider" class="block text-lg font-bold mb-2">Upper Bound $b$</label>
            <input type="range" id="b-slider" min="-3" max="3" value="3" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
            <span id="b-label" class="text-sm text-gray-600 mt-1 block text-center font-mono"></span>
          </div>
          <div>
            <label for="n-slider" class="block text-lg font-bold mb-2">Number of Intervals $n$</label>
            <input type="range" id="n-slider" min="1" max="100" value="10" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
            <span id="n-label" class="text-sm text-gray-600 mt-1 block text-center font-mono"></span>
          </div>
          
          <div>
            <p class="text-lg font-bold mb-2">Quadrature Method</p>
            <div class="flex flex-col space-y-2">
              <label class="flex items-center space-x-2 cursor-pointer">
                <input type="radio" name="quad-method" value="left" checked class="form-radio text-blue-600 focus:ring-blue-500 rounded-full">
                <span class="text-sm text-gray-700">Left Riemann Sum</span>
              </label>
              <label class="flex items-center space-x-2 cursor-pointer">
                <input type="radio" name="quad-method" value="right" class="form-radio text-blue-600 focus:ring-blue-500 rounded-full">
                <span class="text-sm text-gray-700">Right Riemann Sum</span>
              </label>
              <label class="flex items-center space-x-2 cursor-pointer">
                <input type="radio" name="quad-method" value="midpoint" class="form-radio text-blue-600 focus:ring-blue-500 rounded-full">
                <span class="text-sm text-gray-700">Midpoint Rule</span>
              </label>
              <label class="flex items-center space-x-2 cursor-pointer">
                <input type="radio" name="quad-method" value="trapezoidal" class="form-radio text-blue-600 focus:ring-blue-500 rounded-full">
                <span class="text-sm text-gray-700">Trapezoidal Rule</span>
              </label>
              <label class="flex items-center space-x-2 cursor-pointer">
                <input type="radio" name="quad-method" value="simpson" class="form-radio text-blue-600 focus:ring-blue-500 rounded-full">
                <span class="text-sm text-gray-700">Simpson's Rule</span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('quadCanvas');
      const aSlider = document.getElementById('a-slider');
      const bSlider = document.getElementById('b-slider');
      const nSlider = document.getElementById('n-slider');
      const aLabel = document.getElementById('a-label');
      const bLabel = document.getElementById('b-label');
      const nLabel = document.getElementById('n-label');
      const trueIntegralSpan = document.getElementById('true-integral');
      const approxValueSpan = document.getElementById('approx-value');
      const quadErrorValueSpan = document.getElementById('quad-error-value');
      const quadMethodRadios = document.querySelectorAll('input[name="quad-method"]');
      
      const setupCanvas = (canvas, minX, maxX, minY, maxY) => {
      const width = canvas.clientWidth;
      const height = canvas.clientHeight;
      canvas.width = width;
      canvas.height = height;
      
      const xScale = (x) => (x - minX) / (maxX - minX) * width;
      const yScale = (y) => height - (y - minY) / (maxY - minY) * height;
      const toCanvasCoords = (x, y) => ({ x: xScale(x), y: yScale(y) });
      
      return { ctx: canvas.getContext('2d'), width, height, xScale, yScale, toCanvasCoords };
      };
      
      const drawGridAndAxes = (ctx, width, height, xScale, yScale, xMin, xMax, yMin, yMax) => {
      ctx.clearRect(0, 0, width, height);
      ctx.strokeStyle = '#e5e7eb';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(0, yScale(0));
      ctx.lineTo(width, yScale(0));
      ctx.moveTo(xScale(0), 0);
      ctx.lineTo(xScale(0), height);
      ctx.stroke();
      
      ctx.fillStyle = '#6b7280';
      ctx.font = '10px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      for (let i = Math.ceil(xMin); i <= Math.floor(xMax); i++) {
      if (i !== 0) {
      ctx.fillText(i, xScale(i), yScale(0) + 5);
      }
      }
      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';
      for (let i = Math.ceil(yMin / 5) * 5; i <= Math.floor(yMax / 5) * 5; i += 5) {
      if (i !== 0) {
      ctx.fillText(i, xScale(0) - 5, yScale(i));
      }
      }
      };
      
      const func = (x) => (x ** 3) - (6 * x ** 2) + (5 * x) + (10 * Math.sin(3 * x)) + 8;
      const trueIntegral = (x) => (x ** 4) / 4 - 2 * (x ** 3) + 2.5 * (x ** 2) - (10 / 3) * Math.cos(3 * x) + 8*x;
      
      const quadrature = (a, b, n, method) => {
      const h = (b - a) / n;
      let sum = 0;
      switch (method) {
      case 'left':
      for (let i = 0; i < n; i++) sum += func(a + i * h);
      return sum * h;
      case 'right':
      for (let i = 1; i <= n; i++) sum += func(a + i * h);
      return sum * h;
      case 'midpoint':
      for (let i = 0; i < n; i++) sum += func(a + i * h + h / 2);
      return sum * h;
      case 'trapezoidal':
      for (let i = 0; i < n; i++) sum += (func(a + i * h) + func(a + (i + 1) * h)) / 2;
      return sum * h;
      case 'simpson':
      if (n % 2 !== 0) return NaN;
      sum = func(a) + func(b);
      for (let i = 1; i < n; i += 2) sum += 4 * func(a + i * h);
      for (let i = 2; i < n; i += 2) sum += 2 * func(a + i * h);
      return sum * h / 3;
      default: return 0;
      }
      };
      
      const drawQuadPlot = () => {
      const xMin = -3, xMax = 3, yMin = -20, yMax = 20;
      const { ctx, width, height, xScale, yScale, toCanvasCoords } = setupCanvas(canvas, xMin, xMax, yMin, yMax);
      drawGridAndAxes(ctx, width, height, xScale, yScale, xMin, xMax, yMin, yMax);
      
      ctx.strokeStyle = '#10b981';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let i = 0; i < width; i++) {
      const x = xMin + (i / width) * (xMax - xMin);
      const y = func(x);
      const p = toCanvasCoords(x, y);
      if (i === 0) ctx.moveTo(p.x, p.y);
      else ctx.lineTo(p.x, p.y);
      }
      ctx.stroke();
      
      const a = parseFloat(aSlider.value);
      const b = parseFloat(bSlider.value);
      const n = parseInt(nSlider.value);
      const method = document.querySelector('input[name="quad-method"]:checked').value;
      const h = (b - a) / n;
      const approxValue = quadrature(a, b, n, method);
      const trueVal = trueIntegral(b) - trueIntegral(a);
      const error = Math.abs(trueVal - approxValue);
      
      if (method === 'simpson' && n % 2 !== 0) {
      approxValueSpan.textContent = "N must be even";
      quadErrorValueSpan.textContent = "N must be even";
      } else {
      trueIntegralSpan.textContent = trueVal.toFixed(4);
      approxValueSpan.textContent = approxValue.toFixed(4);
      quadErrorValueSpan.textContent = error.toExponential(2);
      }
      
      ctx.fillStyle = 'rgba(59, 130, 246, 0.5)';
      ctx.strokeStyle = '#3b82f6';
      ctx.lineWidth = 1;
      
      if (method === 'simpson') {
      if (n % 2 !== 0) return;
      for (let i = 0; i < n; i += 2) {
      const x_i = a + i * h;
      const x_i_plus_1 = a + (i + 1) * h;
      const x_i_plus_2 = a + (i + 2) * h;
      const y_i = func(x_i);
      const y_i_plus_1 = func(x_i_plus_1);
      const y_i_plus_2 = func(x_i_plus_2);
      const p1 = toCanvasCoords(x_i, y_i);
      const p2 = toCanvasCoords(x_i_plus_1, y_i_plus_1);
      const p3 = toCanvasCoords(x_i_plus_2, y_i_plus_2);
      ctx.beginPath();
      ctx.moveTo(p1.x, yScale(0));
      ctx.lineTo(p1.x, p1.y);
      ctx.quadraticCurveTo(p2.x, p2.y, p3.x, p3.y);
      ctx.lineTo(p3.x, yScale(0));
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
      }
      } else {
      for (let i = 0; i < n; i++) {
      const x_i = a + i * h;
      const x_i_plus_1 = a + (i + 1) * h;
      const y_i = func(x_i);
      const y_i_plus_1 = func(x_i_plus_1);
      let x_draw, y_draw, width_draw, height_draw;
      switch (method) {
      case 'left':
      x_draw = xScale(x_i);
      y_draw = yScale(Math.max(0, y_i));
      width_draw = xScale(x_i_plus_1) - x_draw;
      height_draw = yScale(Math.min(0, y_i)) - y_draw;
      ctx.fillRect(x_draw, y_draw, width_draw, height_draw);
      ctx.strokeRect(x_draw, y_draw, width_draw, height_draw);
      break;
      case 'right':
      x_draw = xScale(x_i_plus_1);
      y_draw = yScale(Math.max(0, y_i_plus_1));
      width_draw = xScale(x_i) - x_draw;
      height_draw = yScale(Math.min(0, y_i_plus_1)) - y_draw;
      ctx.fillRect(x_draw, y_draw, width_draw, height_draw);
      ctx.strokeRect(x_draw, y_draw, width_draw, height_draw);
      break;
      case 'midpoint':
      const midpoint = x_i + h / 2;
      const y_mid = func(midpoint);
      x_draw = xScale(x_i);
      y_draw = yScale(Math.max(0, y_mid));
      width_draw = xScale(x_i_plus_1) - x_draw;
      height_draw = yScale(Math.min(0, y_mid)) - y_draw;
      ctx.fillRect(x_draw, y_draw, width_draw, height_draw);
      ctx.strokeRect(x_draw, y_draw, width_draw, height_draw);
      break;
      case 'trapezoidal':
      const p1 = toCanvasCoords(x_i, y_i);
      const p2 = toCanvasCoords(x_i_plus_1, y_i_plus_1);
      const p3 = toCanvasCoords(x_i_plus_1, 0);
      const p4 = toCanvasCoords(x_i, 0);
      ctx.beginPath();
      ctx.moveTo(p1.x, p1.y);
      ctx.lineTo(p2.x, p2.y);
      ctx.lineTo(p3.x, p3.y);
      ctx.lineTo(p4.x, p4.y);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
      break;
      }
      }
      }
      aLabel.textContent = `Value: ${a.toFixed(2)}`;
      bLabel.textContent = `Value: ${b.toFixed(2)}`;
      nLabel.textContent = `Value: ${n}`;
      };
      aSlider.addEventListener('input', () => {
      if (parseFloat(aSlider.value) >= parseFloat(bSlider.value)) bSlider.value = parseFloat(aSlider.value) + 0.1;
      drawQuadPlot();
      });
      bSlider.addEventListener('input', () => {
      if (parseFloat(bSlider.value) <= parseFloat(aSlider.value)) aSlider.value = parseFloat(bSlider.value) - 0.1;
      drawQuadPlot();
      });
      nSlider.addEventListener('input', () => {
      const method = document.querySelector('input[name="quad-method"]:checked').value;
      if (method === 'simpson') {
      let n = parseInt(nSlider.value);
      if (n % 2 !== 0) {
      n = n > 1 ? n - 1 : 2;
      nSlider.value = n;
      }
      }
      drawQuadPlot();
      });
      quadMethodRadios.forEach(radio => radio.addEventListener('change', () => {
      const method = radio.value;
      const n = parseInt(nSlider.value);
      if (method === 'simpson' && n % 2 !== 0) nSlider.value = n > 1 ? n - 1 : 2;
      drawQuadPlot();
      }));
      drawQuadPlot();
      });
    </script>
  </body>
</html>
